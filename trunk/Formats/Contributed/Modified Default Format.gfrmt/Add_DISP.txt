tell application "GEDitCOM II"	set message visible to falseend telltell application "GEDitCOM II"	tell front document		-- First gather some information about the selected record		set props to properties		set keyRec to (key record of props)		set objectPath to object path of key record		try			set ObjectWidth to contents of structure named "_WIDT" of keyRec		on error			set ObjectWidth to 0		end try		try			set ObjectHeight to contents of structure named "_HEIG" of keyRec		on error			set ObjectHeight to 0		end try	end tell		set diskPath to (path to startup disk as string)	set diskPath to (characters 1 thru ((length of diskPath) - 1)) of diskPath as string		if ObjectHeight is 0 or ObjectWidth is 0 then		tell application "Finder"			set ObjectWidth to do shell script " mdls -name kMDItemPixelWidth " & quoted form of objectPath			set ObjectWidth to (characters 21 thru (length of ObjectWidth) of ObjectWidth) as string			set ObjectHeight to do shell script " mdls -name kMDItemPixelHeight " & quoted form of objectPath			set ObjectHeight to (characters 22 thru (length of ObjectHeight) of ObjectHeight) as string						if ObjectWidth is "(null)" or ObjectHeight is "(null)" then				set ObjectWidth to 400				set ObjectHeight to 300				tell application "GEDitCOM II"					user option title "Warning" message "The size of the object cannot be determined and has been set to 400x300." & return & return & "If this size is not appropriate it can be changed by editing the width and height fields belw and clicking 'refresh'." buttons {"OK"}				end tell			end if						if ObjectWidth > 600 or ObjectHeight > 450 then				if ObjectWidth / ObjectHeight > 600 / 450 then					set ObjectWidth to 600					set ObjectHeight to (ObjectHeight * (450 / 600)) as integer				else					set ObjectWidth to (ObjectWidth * (600 / 450)) as integer					set ObjectHeight to 450				end if				tell application "GEDitCOM II"					user option title "Warning" message "The size of the object is large and has been restricted to " & ObjectWidth & "x" & ObjectHeight & "." & return & return & "If this size is not appropriate it can be changed by editing the display code on the 'Other' tab." buttons {"OK"}				end tell			end if		end tell	end if		set htmlLink to "<div><P align='center'><embed src='file:///" & objectPath & "' alt='" & name of keyRec & "' width='" & ObjectWidth & "' height='" & ObjectHeight & "'></P></div>"			tell keyRec				set curdisp to {}		try			set curdisp to structure named "_DISP"		end try		if curdisp is {} then			make new structure with properties {name:"_DISP", contents:htmlLink}		else			set contents of curdisp to htmlLink		end if				set curwidt to {}		try			set curwidt to structure named "_WIDT"		end try		if curwidt is {} then			make new structure with properties {name:"_WIDT", contents:ObjectWidth as string}		else			set contents of curwidt to ObjectWidth as string		end if				set curheig to {}		try			set curheig to structure named "_HEIG"		end try		if curheig is {} then			make new structure with properties {name:"_HEIG", contents:ObjectHeight as string}		else			set contents of curheig to ObjectHeight as string		end if	end tell	end tell